@model AppModel;

@{
    ViewData["Title"] = "Home Page";
}
<style>
    #webdirect-frame {
        position: fixed;
        top: 0px;
        left: 0px;
        bottom: 0px;
        right: 0px;
        width: 100%;
        height: 100%;
        border: none;
        margin: 0;
        padding: 0;
        overflow: hidden;
        z-index: 999999;
    }
</style>

<iframe id="webdirect-frame" frameborder="0" allowfullscreen src=""></iframe>

@section Scripts {
<script>
    let uri = "@Model.WebDirectFullUri.ToString()";

    history.pushState(null, null, '');

    window.addEventListener("popstate", function () {
        // Prevent Back button click
        history.pushState(null, null, '');

        // select backbutton integration mode
        let singleServerMode = JSON.parse('@(Model != null)'.toLowerCase());
        if (singleServerMode === false) {
            // setup postMessage push to iframe (to be picked up and pushed into listening webviewer)
            // via injected /message-forward.js
            document.getElementById("webdirect-frame").contentWindow.postMessage("@Globals.BackButtonPostEventName", "*");
        }
        else {
            // find the main iframe, then naviage through its children iframes and post the message
            // this only works on single origin solutions.
            let frames = Array.from(
                document
                    .getElementById("webdirect-frame")
                    .contentWindow.document.getElementsByTagName("iframe")
            );
            if (frames.length) {
                // fore each frame found, relay the event by re-posting it down to the child frame
                frames.forEach((frame) => {
                    frame.contentWindow.postMessage("@Globals.BackButtonPostEventName", "*");
                });
            }
        }
    });

    iframe = document.getElementById("webdirect-frame");
    iframe.addEventListener("load", function () {
        history.pushState(null, null, '');
    });

    window.addEventListener("load", function () {
        document.getElementById("webdirect-frame").src = uri;
    });

    window.addEventListener("beforeunload", function (e) {
        e.preventDefault();
        return e.returnValue = "Are you sure you want to exit?";
    });
</script>
}